#pragma checksum "E:\VSSourceCode\SORptMvc\Views\Home\Index.cshtml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "33cd530932bcdb10311eb37021a17b9735d7c81a"
// <auto-generated/>
#pragma warning disable 1591
[assembly: global::Microsoft.AspNetCore.Razor.Hosting.RazorCompiledItemAttribute(typeof(AspNetCore.Views_Home_Index), @"mvc.1.0.view", @"/Views/Home/Index.cshtml")]
namespace AspNetCore
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Mvc;
    using Microsoft.AspNetCore.Mvc.Rendering;
    using Microsoft.AspNetCore.Mvc.ViewFeatures;
#nullable restore
#line 1 "E:\VSSourceCode\SORptMvc\Views\_ViewImports.cshtml"
using SORptMvc;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "E:\VSSourceCode\SORptMvc\Views\_ViewImports.cshtml"
using SORptMvc.Models;

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"33cd530932bcdb10311eb37021a17b9735d7c81a", @"/Views/Home/Index.cshtml")]
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"46b0d893d441c01f83e68e12451eed07f35efc0c", @"/Views/_ViewImports.cshtml")]
    public class Views_Home_Index : global::Microsoft.AspNetCore.Mvc.Razor.RazorPage<dynamic>
    {
        private static readonly global::Microsoft.AspNetCore.Razor.TagHelpers.TagHelperAttribute __tagHelperAttribute_0 = new global::Microsoft.AspNetCore.Razor.TagHelpers.TagHelperAttribute("id", new global::Microsoft.AspNetCore.Html.HtmlString("q"), global::Microsoft.AspNetCore.Razor.TagHelpers.HtmlAttributeValueStyle.DoubleQuotes);
        private static readonly global::Microsoft.AspNetCore.Razor.TagHelpers.TagHelperAttribute __tagHelperAttribute_1 = new global::Microsoft.AspNetCore.Razor.TagHelpers.TagHelperAttribute("style", new global::Microsoft.AspNetCore.Html.HtmlString("display: flex; flex-wrap: wrap;"), global::Microsoft.AspNetCore.Razor.TagHelpers.HtmlAttributeValueStyle.DoubleQuotes);
        #line hidden
        #pragma warning disable 0649
        private global::Microsoft.AspNetCore.Razor.Runtime.TagHelpers.TagHelperExecutionContext __tagHelperExecutionContext;
        #pragma warning restore 0649
        private global::Microsoft.AspNetCore.Razor.Runtime.TagHelpers.TagHelperRunner __tagHelperRunner = new global::Microsoft.AspNetCore.Razor.Runtime.TagHelpers.TagHelperRunner();
        #pragma warning disable 0169
        private string __tagHelperStringValueBuffer;
        #pragma warning restore 0169
        private global::Microsoft.AspNetCore.Razor.Runtime.TagHelpers.TagHelperScopeManager __backed__tagHelperScopeManager = null;
        private global::Microsoft.AspNetCore.Razor.Runtime.TagHelpers.TagHelperScopeManager __tagHelperScopeManager
        {
            get
            {
                if (__backed__tagHelperScopeManager == null)
                {
                    __backed__tagHelperScopeManager = new global::Microsoft.AspNetCore.Razor.Runtime.TagHelpers.TagHelperScopeManager(StartTagHelperWritingScope, EndTagHelperWritingScope);
                }
                return __backed__tagHelperScopeManager;
            }
        }
        private global::Microsoft.AspNetCore.Mvc.TagHelpers.FormTagHelper __Microsoft_AspNetCore_Mvc_TagHelpers_FormTagHelper;
        private global::Microsoft.AspNetCore.Mvc.TagHelpers.RenderAtEndOfFormTagHelper __Microsoft_AspNetCore_Mvc_TagHelpers_RenderAtEndOfFormTagHelper;
        #pragma warning disable 1998
        public async override global::System.Threading.Tasks.Task ExecuteAsync()
        {
#nullable restore
#line 1 "E:\VSSourceCode\SORptMvc\Views\Home\Index.cshtml"
  
    ViewData["Title"] = "Home Page";

#line default
#line hidden
#nullable disable
            WriteLiteral("\r\n<div style=\"margin-bottom:5px\">\r\n    ");
            __tagHelperExecutionContext = __tagHelperScopeManager.Begin("form", global::Microsoft.AspNetCore.Razor.TagHelpers.TagMode.StartTagAndEndTag, "33cd530932bcdb10311eb37021a17b9735d7c81a4041", async() => {
            }
            );
            __Microsoft_AspNetCore_Mvc_TagHelpers_FormTagHelper = CreateTagHelper<global::Microsoft.AspNetCore.Mvc.TagHelpers.FormTagHelper>();
            __tagHelperExecutionContext.Add(__Microsoft_AspNetCore_Mvc_TagHelpers_FormTagHelper);
            __Microsoft_AspNetCore_Mvc_TagHelpers_RenderAtEndOfFormTagHelper = CreateTagHelper<global::Microsoft.AspNetCore.Mvc.TagHelpers.RenderAtEndOfFormTagHelper>();
            __tagHelperExecutionContext.Add(__Microsoft_AspNetCore_Mvc_TagHelpers_RenderAtEndOfFormTagHelper);
            __tagHelperExecutionContext.AddHtmlAttribute(__tagHelperAttribute_0);
            __tagHelperExecutionContext.AddHtmlAttribute(__tagHelperAttribute_1);
            await __tagHelperRunner.RunAsync(__tagHelperExecutionContext);
            if (!__tagHelperExecutionContext.Output.IsContentModified)
            {
                await __tagHelperExecutionContext.SetOutputContentAsync();
            }
            Write(__tagHelperExecutionContext.Output);
            __tagHelperExecutionContext = __tagHelperScopeManager.End();
            WriteLiteral(@"
</div>
<div id=""table"" style=""font-size:16px""></div>
<div>
    共查询出：<span id=""rowcount"">0</span> 行记录
    <div style=""float:right;margin-right:20px"">
        登录人：
        <span id=""user""></span>
        <a id=""cpw"" href=""javascript:void(0);"" style=""margin:5px"">[修改密码]</a>
        <a id=""exit"" href=""javascript:void(0);"" style=""margin:5px"">[退出登录]</a>
    </div>
</div>
<script>
    const columns = JSON.parse('");
#nullable restore
#line 19 "E:\VSSourceCode\SORptMvc\Views\Home\Index.cshtml"
                           Write(Html.Raw(ViewData["conf"]));

#line default
#line hidden
#nullable disable
            WriteLiteral("\');\r\n    const userName = \'");
#nullable restore
#line 20 "E:\VSSourceCode\SORptMvc\Views\Home\Index.cshtml"
                 Write(Html.Raw(ViewData["userName"]??""));

#line default
#line hidden
#nullable disable
            WriteLiteral(@"'
    console.log(userName)
    $('#userName').val(userName);
    const querys = columns.filter(function (col) {
        return col.query == true
    })
    if (querys.length > 0) {
        querys.forEach(q => {
            $('#q').append($(""<div style='margin:5px;width: 250px;'><label for='"" + q.data + ""'>""
                + q.title + ""</label> <input id='txt_""+q.data+""' style='width:100%' placeholder='请输入"" + q.title+""' name='""
                + q.data + ""' type='text' value='' /></div>""))


            $('#txt_' + q.data).keydown(function (event) {
                if (event.keyCode == ""13"") {
                    $('#btnQuery').click();
                }
            })

        })
    }
    $('#q').append(""<div style='margin:5px;width: 250px;'><div style='color:#fff;margin-bottom: .5rem;'>操作区</div>"" +
        ""<input type='button' value='查询' id='btnQuery' style='margin-right:5px'/>""
        +""<input type='button' value='导出查询结果' id='btnExport' />""
        +""</div>"")


    const cont");
            WriteLiteral(@"ainer = document.getElementById('table');
    const hot = new Handsontable(container, {
        data:[],
        height: 'auto',
        width: '100%',
        language: 'zh-CN',
        colHeaders: true,
        columns,
        manualColumnMove: true,
        manualColumnResize: true,
        filters: true,
        className: 'htCenter',
        dropdownMenu: ['filter_by_condition', 'filter_action_bar'],
        licenseKey: 'non-commercial-and-evaluation'
    });

    $('#btnQuery').click(function () {
        var loading =  layer.msg('加载中', { icon: 16 , shade: 0.01 });

        hot.loadData([])
        $(""#rowcount"").html('0')
        $.ajax({
            type: ""POST"",
            url: ""query"",
            data: urltoJSON($('#q').serialize()),
            headers: { 'Authorization': 'Bearer ' + $.cookie('token') },
            success: function (result) {
                if (result.state == ""success"") {
                    hot.loadData(result.data)
                    $(""#rowco");
            WriteLiteral(@"unt"").html(result.data.length)
                } else {
                    layer.msg('查询发生错误!', { icon: 2} );
                }
                layer.close(loading);
            },
            error: function (data) {
                layer.close(loading);
                if (data.status == 401) {
                    data.statusText = ""您尚未登录或授权丢失,请重新登录!"";
                }
                layer.alert(""操作发生错误!\r\n原因："" + data.statusText, { icon: 2 }, function () {
                    window.location.href = ""/login"";
                });
            }
        });
    })

    $('#btnExport').click(function () {
        const rows = hot.getSourceData();
        if (rows.length <= 0) {
            layer.msg('没有要导出的查询结果', { icon: 2});
        } else {
            layer.confirm('确认要导出查询结果吗?', { btn: ['确定', '取消'], title: ""提示"" }, function () {
            var table = hot.toHTML();
            table = table.replace(/<td/g, ""<td STYLE='MSO-NUMBER-FORMAT:\\");
            WriteLiteral(@"@'"");
                tableToExcel(table)
            });
        }
    })

    $('#cpw').click(function () {
        layer.open({
            type: 1,
            title: '修改密码',
            area: ['340px', '285px'],
            anim: 2,
            content: ""<div style='margin:10px'>""
                + ""<div style='margin:10px'><label>新密码</label><input id='npwd' type='password' value='' style='width:100%'></div>""
                +""<div style='margin:10px'><label>确认密码</label><input id='cnpwd' type='password' value='' style='width:100%'></div>""
                + ""</div>"",
            btn: ['确定', '取消'],
            yes: function (index, layero) {
                var npwd = $('#npwd', layero).val();
                var cnpw = $('#cnpwd', layero).val();
                if (npwd.trim().length > 0 && cnpw.trim().length > 0) {
                    if (npwd == cnpw) {
                        layer.close(index);
                    } else {
                        layer.msg('新密码与确认密码不一致', { icon");
            WriteLiteral(@": 2 });
                    }
                } else {
                    layer.msg('请输入新密码和确认密码', { icon: 2 });
                }
            },
            btn2: function (index, layero) {
                layer.close(index)
            }
        });
    })

    $('#exit').click(function () {

        layer.confirm('确认要退出当前账号吗?', { btn: ['确定', '取消'], title: ""提示"" }, function () {
            window.location.href = ""/login"";
            $.cookie('token', null);
        });



    })

    setTimeout(function () {
        const height = $(window).height() - $('#footer').height() - $('#header').height() - $('#rowcount').height() - 115

        hot.updateSettings({
            height
        })
    }, 300)

    window.onresize = function () {
        const height = $(window).height() - $('#footer').height() - $('#header').height() - $('#rowcount').height() - 115

        hot.updateSettings({
            height
        })
    }

    var urltoJSON = function (url) {
        v");
            WriteLiteral(@"ar arr = url.split('&');
        var p = {}
        arr.forEach(a => {
            var k = a.split('=')[0]
            var v = a.split('=')[1]
            p[k] = v;
        })
        return p;
    }

    //base64转码
    var base64 = function (s) {
        return window.btoa(unescape(encodeURIComponent(s)));
    };
    //替换table数据和worksheet名字
    var format = function (s, c) {
        return s.replace(/{(\w+)}/g,
            function (m, p) {
                return c[p];
            });
    }
    function tableToExcel(dom, sheetName) {
        var uri = 'data:application/vnd.ms-excel;base64,';
        var template = '<html xmlns:o=""urn:schemas-microsoft-com:office:office"" xmlns:x=""urn:schemas-microsoft-com:office:excel""' +
            'xmlns=""http://www.w3.org/TR/REC-html40""><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>'
            + '<x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:");
            WriteLiteral(@"ExcelWorksheets>'
            + '</x:ExcelWorkbook></xml><![endif]-->' +
            '</head><body ><table class=""excelTable"">{table}</table></body></html>';

        var ctx = { worksheet: sheetName || 'sheet1', table: dom };
        window.open(uri + base64(format(template, ctx)));
    }
</script>
");
        }
        #pragma warning restore 1998
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.ViewFeatures.IModelExpressionProvider ModelExpressionProvider { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IUrlHelper Url { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IViewComponentHelper Component { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IJsonHelper Json { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IHtmlHelper<dynamic> Html { get; private set; }
    }
}
#pragma warning restore 1591
